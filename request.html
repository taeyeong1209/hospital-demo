<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHA Laboratory - ê²€ì‚¬ ì˜ë¢°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sidebar-bg: #002a5c; /* ì°¨ë³‘ì› ë„¤ì´ë¹„ */
            --sidebar-text: #e2e8f0;
            --primary: #f37321;    /* ì°¨ë³‘ì› ì˜¤ë Œì§€ */
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-dark: #333333;
        }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-color); color: var(--text-dark); display: flex; height: 100vh; overflow: hidden; }
        
        /* ì‚¬ì´ë“œë°” */
        .sidebar { width: 260px; background-color: var(--sidebar-bg); padding: 2rem 1.5rem; display: flex; flex-direction: column; color: white; }
        .logo { font-size: 1.5rem; font-weight: 700; margin-bottom: 3rem; color: white; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px;}
        .menu-item { display: block; padding: 12px 16px; margin-bottom: 8px; color: var(--sidebar-text); text-decoration: none; border-radius: 8px; transition: 0.3s; font-weight: 500; }
        .menu-item:hover { background-color: rgba(255,255,255,0.1); color: white; }
        .menu-item.active { background-color: var(--primary); color: white; box-shadow: 0 4px 6px rgba(243, 115, 33, 0.3); }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content { flex: 1; padding: 2rem 3rem; overflow-y: auto; }
        .header { margin-bottom: 2rem; border-bottom: 2px solid #ddd; padding-bottom: 1rem; }
        .header h2 { font-size: 1.8rem; margin: 0; color: #002a5c; }
        .header p { color: #666; margin-top: 5px; }

        /* ì¹´ë“œ ë° í¼ */
        .card { background: var(--card-bg); padding: 2.5rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); max-width: 800px; border-top: 4px solid var(--primary); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { margin-bottom: 1.5rem; }
        
        label { display: block; margin-bottom: 0.6rem; font-weight: 600; font-size: 0.95rem; color: #002a5c; }
        input[type="text"], select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; transition: 0.2s; background-color: #fff; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(243, 115, 33, 0.1); }
        
        /* ë²„íŠ¼ */
        .btn-submit { background-color: var(--primary); color: white; border: none; padding: 14px; font-size: 1.1rem; font-weight: 600; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.2s; }
        .btn-submit:hover { background-color: #d95e0f; }

        /* ì¡°ê±´ë¶€ í‘œì‹œ ì˜ì—­ (íƒ€ê²Ÿ ìœ ì „ì) */
        .hidden-section { display: none; background-color: #fff4e6; padding: 15px; border-radius: 8px; border: 1px solid #ffe8cc; margin-top: -10px; margin-bottom: 20px; }
        .checkbox-group { display: flex; gap: 20px; flex-wrap: wrap; }
        .checkbox-label { display: flex; align-items: center; font-weight: normal; cursor: pointer; color: #333; margin: 0; }
        .checkbox-label input { margin-right: 8px; width: 18px; height: 18px; accent-color: var(--primary); }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo">ğŸ§¬ CHABiotech Genomics Lab System</div>
        <nav>
            <a href="request.html" class="menu-item active">ğŸ“ ê²€ì‚¬ ì˜ë¢° (Request)</a>
            <a href="result.html" class="menu-item">ğŸ“Š ê²°ê³¼ ì¡°íšŒ (Status)</a>
        </nav>
    </div>

    <div class="main-content">
        <div class="header">
            <h2>ì‹ ê·œ ê²€ì‚¬ ì˜ë¢°</h2>
            <p>í™˜ì ê²€ì²´ ì •ë³´ ë° ë¶„ì„ í•­ëª©(NIPT, ë§˜í”„ë¦¬ ë“±)ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
        </div>

        <div class="card">
            <form id="requestForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>í™˜ì ID (Patient ID)</label>
                        <input type="text" id="pId" placeholder="ì˜ˆ: P-2026-001" required>
                    </div>
                    <div class="form-group">
                        <label>í™˜ì ì„±ëª…</label>
                        <input type="text" id="pName" placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>ê²€ì‚¬ í•­ëª© ì„ íƒ (Test Type)</label>
                    <select id="testType" required onchange="toggleTargetSection()">
                        <option value="" disabled selected>ê²€ì‚¬ í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="NIPT">NIPT (ë¹„ì¹¨ìŠµì  ì‚°ì „ê²€ì‚¬)</option>
                        <option value="Mom-Free">ë§˜í”„ë¦¬ (Mom-Free) ë³´ì¸ì ê²€ì‚¬</option>
                        <option value="NGS Panel">NGS ìœ ì „ì²´ íŒ¨ë„</option>
                        <option value="General">ì¼ë°˜ ìœ ì „ ê²€ì‚¬</option>
                    </select>
                </div>

                <div id="targetSection" class="hidden-section">
                    <label style="color:#d95e0f;">ğŸ¯ ë§˜í”„ë¦¬ íƒ€ê²Ÿ ìœ ì „ì ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="targets" value="SMA"> SMA (ì²™ìˆ˜ì„± ê·¼ìœ„ì¶•ì¦)</label>
                        <label class="checkbox-label"><input type="checkbox" name="targets" value="DM1"> DM1 (ê·¼ê¸´ì¥ì„± ì´ì˜ì–‘ì¦)</label>
                        <label class="checkbox-label"><input type="checkbox" name="targets" value="MTHFR"> MTHFR (ì—½ì‚° ëŒ€ì‚¬)</label>
                        <label class="checkbox-label"><input type="checkbox" name="targets" value="Fragile X"> Fragile X (ì·¨ì•½ X ì¦í›„êµ°)</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>ì„ìƒ ì†Œê²¬ (Clinical Notes)</label>
                    <textarea id="memo" rows="3" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥"></textarea>
                </div>

                <button type="submit" class="btn-submit">ê²€ì‚¬ ì˜ë¢° ì ‘ìˆ˜í•˜ê¸°</button>
            </form>
        </div>
    </div>

    <script>
        // ë§˜í”„ë¦¬ ì„ íƒ ì‹œ íƒ€ê²Ÿ ì˜µì…˜ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
        function toggleTargetSection() {
            const testType = document.getElementById('testType').value;
            const targetSection = document.getElementById('targetSection');
            
            if (testType === 'Mom-Free') {
                targetSection.style.display = 'block';
            } else {
                targetSection.style.display = 'none';
                // ìˆ¨ê¸¸ ë•Œ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                document.querySelectorAll('input[name="targets"]').forEach(el => el.checked = false);
            }
        }

        document.getElementById('requestForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // ì²´í¬ë°•ìŠ¤ ê°’ ê°€ì ¸ì˜¤ê¸°
            const selectedTargets = [];
            document.querySelectorAll('input[name="targets"]:checked').forEach((checkbox) => {
                selectedTargets.push(checkbox.value);
            });

            const testType = document.getElementById('testType').value;
            let finalTestName = testType;
            
            // ë§˜í”„ë¦¬ì¸ ê²½ìš° íƒ€ê²Ÿ ì •ë³´ë¥¼ í•¨ê»˜ ì €ì¥
            if (testType === 'Mom-Free' && selectedTargets.length > 0) {
                finalTestName = `Mom-Free [${selectedTargets.join(', ')}]`;
            }

            const newRequest = {
                id: document.getElementById('pId').value,
                name: document.getElementById('pName').value,
                test: finalTestName,
                rawTestType: testType, // ë¡œì§ìš© ì›ë³¸ íƒ€ì…
                targets: selectedTargets.join('; '), // CSVìš© ë°ì´í„°
                date: new Date().toISOString().split('T')[0],
                status: 'Processing'
            };

            let db = JSON.parse(localStorage.getItem('hospitalDB')) || [];
            db.push(newRequest);
            localStorage.setItem('hospitalDB', JSON.stringify(db));

            if(confirm("ì˜ë¢°ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                window.location.href = 'result.html';
            } else {
                document.getElementById('requestForm').reset();
                toggleTargetSection();
            }
        });
    </script>
</body>
</html>